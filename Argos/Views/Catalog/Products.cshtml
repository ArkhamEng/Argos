@model Argos.ViewModels.Inventory.SearchProductsVM

@{
    ViewBag.Title = "Catálogo de Productos";
    ViewBag.Class = "fa fa-cubes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<hr />
<div class="panel panel-danger">
    <div class="panel-body">
        <div class="col-md-11 input-group">
            @Html.DropDownListFor(m=> m.Filter.CategoryId, Model.Lists.Categories, "Categoría", new { @class = "form-control text-uppercase", style = "width:20% !important" })
            @Html.DropDownListFor(m => m.Filter.SubCategoryId, Model.Lists.SubCategories, "Sub Categoría", new { @class = "form-control text-uppercase", style = "width:20% !important" })
            @Html.TextBoxFor(m=> m.Filter.Text, "", htmlAttributes: new { @class = "form-control text-uppercase", placeholder = "Búsqueda por código o descripción", style = "width:60% !important" })
            <div class="input-group-btn">
                <button class="btn btn-primary " type="button" title="Buscar productos" onclick="SearchProducts()">
                    <span class="glyphicon glyphicon-search"></span>
                    Buscar
                </button>
                <button type="button" class="btn btn-success hidden-xs hidden-sm" title="Registrar nuevo producto" onclick="BeginAddProduct()">
                    <span class="glyphicon  glyphicon-file"></span>
                    Nuevo
                </button>
            </div>
        </div>
        
        <div class="input-group col-md-10 hidden-sm hidden-xs" style="margin-top:10px">
            <span class="input-group-addon"><i class="fa fa-registered"></i></span>
            @Html.DropDownListFor(m=> m.Filter.MakerId, Model.Lists.Makers, "Armadora", new { @class = "form-control text-capitalize" })
            <span class="input-group-addon"><i class="fa fa-car"></i></span>
            @Html.DropDownListFor(m => m.Filter.ModelId, Model.Lists.Models, "Modelo", new { @class = "form-control text-capitalize" })
            <span class="input-group-addon"><i class="fa fa-calendar-check-o"></i></span>
            @Html.DropDownListFor(m => m.Filter.Year, Model.Lists.Models, "Año", new { @class = "form-control text-capitalize" })
            <span class="input-group-btn">
                <button class="btn btn-info" type="button" id="btnClear" title="Recargar">
                    <span class="glyphicon glyphicon-refresh"></span>
                    Limpiar
                </button>
            </span>
        </div>
    </div>
</div>


<div class="panel panel-default">
    <div id="divProductList" class="panel-body" style="min-height:300px">
        @Html.Partial("_ProductList", Model.Products)
    </div>
</div>

<script>
    $(document).ready(function () {
        SetCascade('#Filter_MakerId', '#Filter_ModelId', '@Url.Action("GetModels","Configuration")');

        SetCascade('#Filter_ModelId', '#Filter_Year', '@Url.Action("GetYears", "Configuration")');

        SetCascade('#Filter_CategoryId', '#Filter_SubCategoryId', '@Url.Action("GetProductSubCategories", "Configuration")');
    });

    function BeginAddProduct()
    {
        ShowProductModal(SearchById, null);
    }

    function BeginUpdateProduct(id)
    {
        ShowProductModal(SearchById,null, id);
    }

    function SearchById(id)
    {
        console.log("Buscando producto");
        var filter = { ProductId: id };

        ExecuteAjax('@Url.Action("SearchProducts")', { id: id }, function (response)
        {
            $("#divProductList").html(response);
        });
    }

    function SearchProducts()
    {
        ShowLoading('static');

        var filter = {
            CategoryId: $("#Filter_CategoryId").val(), SubCategoryId: $("#Filter_SubCategoryId").val(), Text: $("#Filter_Text").val(),
            MakerId: $("#Filter_MakerId").val(), ModelId: $("#Filter_ModelId").val(), Year: $("#Filter_Year").val()
        };

        console.log(filter);

        ExecuteAjax('@Url.Action("SearchProducts","Catalog")', { filter: filter }, function (response)
        {
            HideLoading(function () {
                $("#divProductList").html(response);
            });
        });
    }

    function Clear() {
        window.location = window.location;
    }
</script>
